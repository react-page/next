{"version":3,"sources":["../../../src/Controls/index.tsx","../../../src/utils/makeUniformsSchema.ts"],"names":[],"mappings":"wrBAmBM,EAAgB,WAEhB,EAAkB,aAElB,EAAwC,CAC1C,YAAW,GA6EA,UAjEf,SAAqB,GACnB,IAAM,EAAgB,sBACpB,KAAS,SAAC,GAAS,SAAM,SAAN,KAAmB,KACtC,CAAC,EAAM,WAGH,4BAAC,OAAS,OACd,OAAF,YAAE,EAAQ,WACR,EAAW,EAAM,SAChB,CAAC,EAAM,KAAM,EAAM,QAEpB,IAAI,EAAW,uBAAY,SAAC,GAC5B,EAAW,GACX,EAAc,KACb,IAGD,YACA,UACA,WACA,oCACA,aACA,WAEI,EAAS,mBAAQ,WAAM,wBAA+B,CAAC,IAO3D,OANA,OAAF,YAAE,EAAQ,W,MACR,EAAQ,OAnCY,SAAU,GAChC,OAAO,EAAO,aAAa,MAAM,QAC/B,SAAC,EAAK,G,MAAc,cACf,KAAG,MACL,GAAY,EAAO,gBAAgB,GAAU,MAEhD,IA8BM,CAAgB,IACA,QAAjB,EAAQ,OAAP,QAAO,IAAP,IAAW,SAAK,QAAI,OAEzB,CAAC,IAEF,oCACE,kBAAC,EAAQ,KAAK,EAAK,CAAE,MAAc,OAAP,QAAO,IAAP,IAAW,KAEvC,kBAAC,IAAa,GACR,KAAE,EACN,MAAO,EAAM,KACb,SAAU,EACV,KAAM,EAAM,eACR,GAEJ,yBAAK,MAAO,CAAE,aAAc,GAAI,UAAW,OAAQ,SAAU,SAC3D,kBAAC,EAAQ,CACP,MAAO,GAAW,EAClB,UAAU,EACV,OAAQ,EACR,SAAU,GAEV,yBACE,MAAO,CACL,YAAa,EAAe,aAAe,EAC3C,WAAY,oBACZ,UAAW,KAGb,kBAAC,EAAU,CAAC,QAAS,oB,+QCxF7B,EAAM,IAAI,IAAI,CAAE,WAAW,EAAM,aAAa,IAuBrC,IAVf,SACE,GAEE,IAAI,EAAU,GACV,KAAE,UACH,GAEL,OAAO,IAAI,mBAAiB,EAlB9B,SAA2C,GACvC,IAAI,EAAY,EAAI,QAAQ,GAE5B,OAAK,SAAC,GAEN,GADA,EAAU,GACN,EAAU,QAAU,EAAU,OAAO,OACvC,KAAM,CAAE,QAAS,EAAU,SAYS,CAAgB","file":"static/js/8.b7c156d1.chunk.js","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { BottomToolbar } from '@react-page/ui';\nimport debounce from 'lodash.debounce';\nimport React, { Fragment, useCallback, useEffect, useMemo, useState, } from 'react';\nimport { AutoFields as AutoFieldsOrg, AutoForm as AutoFormOrg, } from 'uniforms-material';\nimport makeUniformsSchema from '../utils/makeUniformsSchema';\n// see https://github.com/vazco/uniforms/issues/617\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar AutoForm = AutoFormOrg;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar AutoFields = AutoFieldsOrg;\nvar defaultControlsLayout = {\n    columnCount: 2,\n};\nvar getDefaultValue = function (bridge) {\n    return bridge.getSubfields(null).reduce(function (acc, fieldName) {\n        var _a;\n        return (__assign(__assign({}, acc), (_a = {}, _a[fieldName] = bridge.getInitialValue(fieldName), _a)));\n    }, {});\n};\nfunction Controls(props) {\n    var saveDebounced = useCallback(debounce(function (m) { return props.onChange(m); }, 1000), [props.onChange]);\n    var _a = __read(useState(), 2), preview = _a[0], setPreview = _a[1];\n    useEffect(function () {\n        setPreview(props.state);\n    }, [props.lang, props.state]);\n    var onSubmit = useCallback(function (model) {\n        setPreview(model);\n        saveDebounced(model);\n    }, []);\n    var focused = props.focused, state = props.state, schema = props.schema, _b = props.controlsLayout, controlsLayout = _b === void 0 ? defaultControlsLayout : _b, Renderer = props.Renderer, remove = props.remove;\n    var bridge = useMemo(function () { return makeUniformsSchema(schema); }, [schema]);\n    useEffect(function () {\n        var _a;\n        onSubmit(__assign(__assign({}, getDefaultValue(bridge)), ((_a = preview !== null && preview !== void 0 ? preview : state) !== null && _a !== void 0 ? _a : {})));\n    }, [bridge]);\n    return (React.createElement(React.Fragment, null,\n        React.createElement(Renderer, __assign({}, props, { state: preview !== null && preview !== void 0 ? preview : state })),\n        React.createElement(BottomToolbar, __assign({ open: focused, title: props.text, onDelete: remove, icon: props.IconComponent }, props),\n            React.createElement(\"div\", { style: { marginBottom: 24, maxHeight: '50vh', overflow: 'auto' } },\n                React.createElement(AutoForm, { model: preview || state, autosave: true, schema: bridge, onSubmit: onSubmit },\n                    React.createElement(\"div\", { style: {\n                            columnCount: controlsLayout.columnCount || 2,\n                            columnRule: '1px solid #E0E0E0',\n                            columnGap: 48,\n                        } },\n                        React.createElement(AutoFields, { element: Fragment })))))));\n}\nexport default Controls;\n//# sourceMappingURL=index.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n/* eslint-disable @typescript-eslint/ban-types */\nimport Ajv from 'ajv';\nimport { JSONSchemaBridge } from 'uniforms-bridge-json-schema';\nvar ajv = new Ajv({ allErrors: true, useDefaults: true });\nfunction createValidator(schema) {\n    var validator = ajv.compile(schema);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return function (model) {\n        validator(model);\n        if (validator.errors && validator.errors.length) {\n            throw { details: validator.errors };\n        }\n    };\n}\nfunction makeUniformsSchema(jsonSchema) {\n    var fullSchema = __assign({ type: 'object' }, jsonSchema);\n    return new JSONSchemaBridge(fullSchema, createValidator(fullSchema));\n}\nexport default makeUniformsSchema;\n//# sourceMappingURL=makeUniformsSchema.js.map"],"sourceRoot":""}